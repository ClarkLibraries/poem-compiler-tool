<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packet Compiler</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 2em auto;
            padding: 1em;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2.5em 1.5em;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            background-color: #f9fafb;
        }
        .file-upload-area:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .file-upload-area.has-files {
            border-color: #10b981; /* Green border when files are selected */
            background-color: #ecfdf5; /* Light green background when files are selected */
        }
        .file-upload-area input[type="file"] {
            display: none;
        }
        .file-upload-area span {
            display: block;
            margin-bottom: 0.5em;
        }
        .file-upload-area small {
            color: #6b7280;
        }
        .packet-item {
            list-style: none;
            cursor: grab; /* Indicates draggable */
            margin-bottom: 0.75em;
            /* Tailwind classes already define much of this: */
            /* bg-white p-4 shadow-sm rounded-lg flex items-center justify-between transition-all duration-200 ease-in-out */
        }
        .packet-item.dragging {
            opacity: 0.5;
            border: 2px dashed #3b82f6;
            background-color: #e0f2fe;
        }
        #progressContainer {
            display: none; /* Hidden by default */
        }
        #notification {
            opacity: 0; /* Hidden by default, controlled by JS */
        }
        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #fff;
            padding: 2em;
            border-radius: 8px;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        .modal-close-btn {
            position: absolute;
            top: 1em;
            right: 1em;
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        /* Styling for content within the modal - from Mammoth.js HTML */
        #packetModalContent p {
            margin-bottom: 0.5em;
        }
        #packetModalContent h1, #packetModalContent h2, #packetModalContent h3, #packetModalContent h4, #packetModalContent h5, #packetModalContent h6 {
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        #packetModalContent ul, #packetModalContent ol {
            margin-left: 1.5em;
            margin-bottom: 0.5em;
        }
        #packetModalContent li {
            margin-bottom: 0.2em;
        }
    </style>
</head>
<body class="bg-gray-100 p-6">
    <div class="container bg-white p-8 rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">Packet Compiler</h1>

        <div class="mb-8">
            <label for="wordFiles" id="fileLabel" class="file-upload-area block text-blue-600 font-medium text-lg">
                <span>ðŸ“„ Click here or drag Word documents to upload</span>
                <small>Multiple files supported</small>
                <input type="file" id="wordFiles" accept=".docx" multiple>
            </label>
            <p class="text-sm text-gray-500 mt-2 text-center" id="process-status" aria-live="polite">No documents selected.</p>
        </div>

        <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 mb-8">
            <button id="processBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Process Documents
            </button>
            <button id="downloadBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Download Combined HTML
            </button>
            <button id="clearBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg shadow-md transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Clear All
            </button>
        </div>

        <div id="progressContainer" class="w-full bg-gray-200 rounded-full h-4 mb-6">
            <div id="progressBar" class="bg-blue-500 h-4 rounded-full text-xs text-white flex items-center justify-center" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                <span class="sr-only">0% Complete</span>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Loaded packets (<span id="packetCount">0</span>)</h2>
        <p id="packetsPlaceholder" class="text-gray-500 text-center py-8">
            No packets loaded yet. Upload and process Word documents to see them here!
        </p>
        <ul id="packetsList" class="space-y-3">
        </ul>
        <p id="packet-list-status" class="sr-only" aria-live="polite"></p>
    </div>

    <div id="notification" class="notification fixed bottom-4 right-4 p-3 rounded-md shadow-lg text-white opacity-0 transition-opacity duration-300 z-50">
    </div>

    <div id="packetModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="packetModalTitle" aria-hidden="true">
        <div class="modal-content">
            <button id="closeModal" class="modal-close-btn" aria-label="Close packet view">&times;</button>
            <h2 id="packetModalTitle" class="text-2xl font-bold mb-4 text-gray-800">packet Title</h2>
            <div id="packetModalContent" class="prose max-w-none">
            </div>
        </div>
    </div>

    <div class="container bg-white p-8 rounded-lg shadow-xl mt-8">
        <details>
            <summary class="text-xl font-bold text-gray-800 cursor-pointer py-2">
                Tips for Faculty: Getting the Best Results from the Packet Compiler
            </summary>
            <div class="prose max-w-none text-gray-700 mt-4">
                <p class="mb-4">
                    Welcome, faculty members! This Packet Compiler is designed to help you organize and distribute course materials efficiently. By converting your Word documents (.docx) into a single, navigable HTML file, it simplifies content delivery for your students. To get the most accurate and organized results, consider the following formatting guidelines for your source documents:
                </p>

                <h3 class="text-lg font-semibold mb-2">1. Consistent Heading Structure is Key</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Use Built-in Heading Styles:</strong> The tool works best when you use Word's built-in heading styles (e.g., Heading 1, Heading 2, Heading 3) to title your sections or "packets" within a document. For example, if you have multiple readings or concepts within one Word file, mark each new item with a Heading style.</li>
                    <li><strong>Clear Packet Titles:</strong> The text you apply a heading style to will be used as the title for each "packet" in the compiled document and in the Table of Contents. Make these titles concise and descriptive.</li>
                    <li><strong>Primary Method for Splitting:</strong> The compiler primarily uses these headings to identify where one packet ends and another begins. This is the most reliable method for multi-packet extraction.</li>
                </ul>

                <h3 class="text-lg font-semibold mb-2">2. Alternative Separation Methods (Use with Caution)</h3>
                <p class="mb-2">
                    While headings are preferred, the tool can also attempt to identify packets using other patterns if no headings are present or if you wish to split content differently:
                </p>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Explicit Separators:</strong> You can use a line of three or more asterisks (<code>***</code>), hyphens (<code>---</code>), underscores (<code>___</code>), equals signs (<code>===</code>), or tildes (<code>~~~</code>) on a blank line to explicitly separate content. These should be on their own line, ideally centered, to be most effective.</li>
                    <li><strong>Multiple Empty Paragraphs:</strong> Two or more consecutive empty paragraphs (just pressing Enter/Return twice or more) can also signal a new packet. This method is less reliable and should be a last resort.</li>
                </ul>
                <p class="mb-4 text-sm text-red-700">
                    <strong>Warning:</strong> Relying solely on explicit separators or empty paragraphs for splitting can sometimes lead to less accurate packet identification, especially with inconsistent document formatting. Headings are always recommended.
                </p>

                <h3 class="text-lg font-semibold mb-2">3. Single Document vs. Multiple Packets</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>One Packet Per File:</strong> If your .docx file contains only one distinct piece of content (e.g., a single lecture note or reading), the tool will treat the entire document as one packet. It will attempt to derive a title from the first meaningful text, or use the filename.</li>
                    <li><strong>Multiple Packets Per File:</strong> If your .docx file contains several distinct sections (e.g., Week 1 Readings, Week 2 Readings) that you want treated as individual, reorderable "packets," use the heading structure or explicit separators as described above.</li>
                </ul>

                <h3 class="text-lg font-semibold mb-2">4. What to Expect in the Output HTML</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Table of Contents:</strong> The exported HTML will include an interactive Table of Contents at the top, allowing students to quickly navigate to specific packets.</li>
                    <li><strong>Cleaned Titles:</strong> The title you see in the Table of Contents and at the start of each packet section will be derived from your document's headings or inferred. If the extracted content already contains that exact heading as its first element, the tool will attempt to remove the duplicate for a cleaner presentation.</li>
                    <li><strong>Preserved Formatting (Mostly):</strong> The tool aims to preserve basic formatting (bold, italics, lists, tables, images, hyperlinks) as much as possible, converting it from Word to HTML. Complex layouts or advanced Word features might not translate perfectly.</li>
                    <li><strong>Images:</strong> Images are embedded directly into the HTML (Base64 encoded), ensuring they appear correctly without needing separate files.</li>
                </ul>

                <h3 class="text-lg font-semibold mb-2">5. General Usage Tips</h3>
                <ul class="list-disc list-inside mb-4 space-y-1">
                    <li><strong>Preview Packets:</strong> Use the "View" button next to each loaded packet to inspect its content and ensure it was extracted correctly before downloading the combined document.</li>
                    <li><strong>Reorder Easily:</strong> Drag and drop packets in the list, or use the up/down arrow buttons, to arrange them in your desired sequence for the final compiled document.</li>
                    <li><strong>Clear and Re-upload:</strong> If you're not satisfied with the packet breakdown, use the "Clear All" button to reset the tool and try uploading adjusted versions of your Word documents.</li>
                    <li><strong>File Naming:</strong> While not critical for functionality, clear and consistent file names for your original .docx files can help you identify sources of packets easily in the tool.</li>
                </ul>
                <p class="mb-4">
                    We hope this tool assists you in creating highly accessible and organized learning materials. If you encounter any issues or have suggestions, please provide feedback!
                </p>
            </div>
        </details>
    </div>

    <script src="https://unpkg.com/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
